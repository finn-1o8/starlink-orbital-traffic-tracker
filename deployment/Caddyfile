# Main domain - Landing page
karmanlab.org, www.karmanlab.org {
    reverse_proxy landing:80 {
        header_up Host {host}
    }
    
    # Tracker routes
    handle /tracker* {
        uri strip_prefix /tracker
        reverse_proxy tracker-frontend:80 {
            header_up Host {host}
        }
    }
    
    # API routes
    handle /api* {
        reverse_proxy tracker-backend:8000 {
            header_up Host {host}
        }
    }
    
    # WebSocket support
    handle /ws* {
        reverse_proxy tracker-backend:8000 {
            header_up Host {host}
        }
    }
    
    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy no-referrer-when-downgrade
    }
}

# Optional: Separate subdomain for tracker
tracker.karmanlab.org {
    reverse_proxy tracker-frontend:80 {
        header_up Host {host}
    }
    
    handle /api* {
        reverse_proxy tracker-backend:8000 {
            header_up Host {host}
        }
    }
    
    handle /ws* {
        reverse_proxy tracker-backend:8000 {
            header_up Host {host}
        }
    }
    
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy no-referrer-when-downgrade
    }
}

